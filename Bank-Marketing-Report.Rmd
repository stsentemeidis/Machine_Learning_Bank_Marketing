---
title: "Predicting Term Deposits"
author: "MBD | ADVANCED R | June 2019"
always_allow_html: yes
output:
  html_document:
    theme: yeti
    code_folding: 'none' 
  github_document: default
params: 
  shiny: TRUE
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries, echo = FALSE, include = FALSE}
source('scripts/install_packages.R')

if (is.null(webshot:::find_phantom())) {
  webshot::install_phantomjs()
}
```

``` {r Load Prepared Data, echo = FALSE}
load('data_output/RMarkdown_Objects.RData')
```

``` {r Palettes, echo = FALSE}
BarFillColor <- "#330066"
HBarFillColor <- "#000099"
BarLineColor <- "#FFFAFA"
MissingColor <- "#FF6666"

color1 = 'white'
color2 = 'black'
color3 = 'black'
color4 = 'darkorchid3'
font1 = 'Impact'
font2 = 'Helvetica'
```

</br>

***

## Bank Marketing Dataset  

BLABLABLAThe *Bank Marketing* dataset contains the **direct marketing campaigns of a Portuguese banking institution**. The original dataset can be found on [Kaggle](https://www.kaggle.com/henriqueyamahata/bank-marketing).  

All the files of this project are saved in a [GitHub repository](https://github.com/ashomah/Bank-Marketing).  

The dataset consists in:  

* **Train Set** with `r nrow(raw_train)` observations with `r length(raw_train)-1` features and the target `y`.  
* **Test Set** with `r nrow(raw_test)` observations with `r length(raw_test)` features. The `y` column will be added to the Test Set, with NAs, to ease the pre-processing stage.  

This project aims to predict if a customer will subscribe to a bank term deposit, based on its features and call history.  

</br>

***

## Packages  

<span style="color:red">This analysis requires these R packages:</span>  

* Data Manipulation: `data.table`, `dplyr`, `tibble`, `tidyr`  
    
* Plotting: `corrplot`, `GGally`, `ggmap`, `ggplot2`, `grid`, `gridExtra`  
    
* Machine Learning: `caret`, `dbscan`, `glmnet`, `leaderCluster`, `MLmetrics`, `ranger`, `xgboost`  

* Multithreading: `doMC`, `doParallel`, `factoextra`, `foreach`, `parallel`  

* Reporting: `kableExtra`, `knitr`, `RColorBrewer`, `shiny`, and... `beepr`.  

These packages are installed and loaded if necessary by the main script.

</br>

***
 
## Data Preparation  

The dataset is pretty clean...  

``` {r ,echo = FALSE}
knitr::include_app('http://ashomah.shinyapps.io/test')
```


</br>

***

## Exploratory Data Analysis  

The target of this analysis is...  

### Missings Treatment

```{r, message=FALSE, warning=FALSE, echo=TRUE}
bank_train_plot <- bank_train
BarFillColor <- "#330066"
HBarFillColor <- "#000099"
BarLineColor <- "#FFFAFA"
MissingColor <- "#FF6666"

# Palette Colour
color1 = 'white'
color2 = 'black'
color3 = 'black'
color4 = 'darkturquoise'
font1 = 'Impact'
font2 = 'Helvetica'

numcols <- c('age','balance','day','duration','campaign','pdays')
missmap(bank_train_plot[,numcols], y.labels = NULL, y.at = NULL, 
        main = 'Missing values per Numeric variable', rank.order = TRUE,
        col = c(color3, color4)) #No missing values in Numeric variables

#Numeric Variables: No missings

catcols <- c("default","housing","loan","job","marital","education","contact","month","poutcome","y")
bank_train_plot[,catcols] <- data.frame(apply(bank_train[catcols], 2, as.factor))
missmap(bank_train[,catcols], y.labels = NULL, y.at = NULL, 
        main = 'Missing values per Categorical variable', rank.order = TRUE,
        col = c(color3, color4)) #No missing values in Categorical variables
#Categorical Variables: No missings
```

### Univariate Analysis: Categorical Variables

```{r, message=FALSE, warning=FALSE, echo=FALSE}
for (i in catcols){
  if (i == 'job' | i == 'month'){
    bank_train_plot[, i] <- as.factor(bank_train_plot[,i])
    assign(paste0(i,'_factor_plot'), ggplot(bank_train_plot, aes_string(x=i)) +
           geom_bar(fill = color4)+
           theme_tufte(base_size = 5, ticks=F)+
           theme(plot.margin = unit(c(10,10,10,10),'pt'),
                 axis.title=element_blank(),
                 axis.text = element_text(colour = color2, size = 7, family = font2),
                 axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
                 legend.position = 'None',
                 plot.background = element_rect(fill = color1)))}
  else{
    bank_train_plot[, i] <- as.factor(bank_train_plot[,i])
    assign(paste0(i,'_factor_plot'), ggplot(bank_train_plot, aes_string(x=i)) +
             geom_bar(fill = color4)+
             theme_tufte(base_size = 5, ticks=F)+
             theme(plot.margin = unit(c(10,10,10,10),'pt'),
                   axis.title=element_blank(),
                   axis.text = element_text(colour = color2, size = 7, family = font2),
                   axis.text.x = element_text(hjust = 1, size = 7, family = font2),
                   legend.position = 'None',
                   plot.background = element_rect(fill = color1)))
  }
}

grid.arrange(default_factor_plot,
             housing_factor_plot,
             loan_factor_plot,
             job_factor_plot,
             marital_factor_plot,
             education_factor_plot,
             contact_factor_plot,
             month_factor_plot,
             poutcome_factor_plot,
             y_factor_plot)
```

### Univariate Analysis: Numerical Variables

```{r, message=FALSE, warning=FALSE, echo=FALSE}
#Age
age_box_plot <- ggplot(bank_train, aes(x='age', y=age)) +
                geom_boxplot(fill = color4, outlier.colour = color2, alpha=0.6)+
                coord_flip()+
                theme_tufte(base_size = 5, ticks=F)+
                theme(plot.margin = unit(c(10,10,10,10),'pt'),
                 axis.title=element_blank(),
                 axis.text = element_text(colour = color2, size = 7, family = font2),
                 axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
                 legend.position = 'None',
                 plot.background = element_rect(fill = color1))


#Balance
balance_box_plot <- ggplot(bank_train, aes(x='balance', y=balance)) +
  geom_boxplot(fill = color4, outlier.colour = color2, alpha=0.6)+
  coord_flip()+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color2, size = 7, family = font2),
        axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

#Day
day_box_plot <- ggplot(bank_train, aes(x='day', y=day)) +
  geom_boxplot(fill = color4, outlier.colour = color2, alpha=0.6)+
  coord_flip()+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color2, size = 7, family = font2),
        axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

#Duration
duration_box_plot <- ggplot(bank_train, aes(x='duration', y=duration)) +
  geom_boxplot(fill = color4, outlier.colour = color2, alpha=0.6)+
  coord_flip()+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color2, size = 7, family = font2),
        axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

#Campaign
campaign_box_plot <- ggplot(bank_train, aes(x='campaign', y=campaign)) +
  geom_boxplot(fill = color4, outlier.colour = color2, alpha=0.6)+
  coord_flip()+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color2, size = 7, family = font2),
        axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

#Pdays
pdays_box_plot <- ggplot(bank_train, aes(x='pdays', y=pdays)) +
  geom_boxplot(fill = color4, outlier.colour = color2, alpha=0.6)+
  coord_flip()+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color2, size = 7, family = font2),
        axis.text.x = element_text(hjust = 1, size = 7, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

grid.arrange(age_box_plot,
             balance_box_plot,
             day_box_plot,
             duration_box_plot,
             campaign_box_plot,
             pdays_box_plot)
```

### Bivariate Analysis: Each Variable against Target (Y)

Let'start from the *Categorical Variables* :

#### Job
```{r, message=FALSE, warning=FALSE, echo=FALSE}

# Copy dataframe for the plots
bank_train_plot <- bank_train

mytable <- table(bank_train_plot$job, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("job", "y", "perc")

ba_job_plot <- ggplot(data = tab, aes(x = job, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Job")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_job_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Job",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```



#### Marital status

```{r, message=FALSE, warning=FALSE, echo = FALSE}

mytable <- table(bank_train_plot$marital, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("marital", "y", "perc")

ba_marital_plot <- ggplot(data = tab, aes(x = marital, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Marital")+
  ylab("Percent")+
  coord_cartesian(ylim = c(0, 1))+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_marital_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Marital",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```

Single people are more likely to open a deposit. Married people are less likely. Divorced 50%-50%

#### Education

```{r, message=FALSE, warning=FALSE, echo=FALSE}
mytable <- table(bank_train_plot$education, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("education", "y", "perc")

ba_education_plot <- ggplot(data = tab, aes(x = education, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Education")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_education_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Education",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))
```

Higher education, higher chance to open a deposit.

#### Contact

```{r, echo=FALSE, warning=FALSE, message=FALSE}

mytable <- table(bank_train_plot$contact, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("contact", "y", "perc")

ba_contact_plot <- ggplot(data = tab, aes(x = contact, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Contact")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_contact_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Contact",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))
```

People contacted via cellular are more likely to open a deposit.

#### Month

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mytable <- table(bank_train_plot$month, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("month", "y", "perc")

ba_month_plot <- ggplot(data = tab, aes(x = month, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Month")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_month_plot
grid.text(unit(0.2, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Month",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))
```

#### Default

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mytable <- table(bank_train_plot$default, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("default", "y", "perc")

ba_default_plot <- ggplot(data = tab, aes(x = default, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Default")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_default_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Default",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))
```

#### Housing

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mytable <- table(bank_train_plot$housing, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("housing", "y", "perc")

ba_housing_plot <- ggplot(data = tab, aes(x = housing, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Housing")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_housing_plot
grid.text(unit(0.62, 'npc'), unit(0.97,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Housing",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))
```


#### Loan

```{r, echo=FALSE, message=FALSE, warning=FALSE}

mytable <- table(bank_train_plot$loan, bank_train_plot$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("loan", "y", "perc")

ba_loan_plot <- ggplot(data = tab, aes(x = loan, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) +
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Loan")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))
ba_loan_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Loan",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```

Let's continue with the *numerical* variables. In order to be able to display the relationship between the variable Target(Y) and the numerical variables, the latter have been binned, in order to make the graph easier to read.

#### Age

```{r, echo=FALSE, warning=FALSE, message=FALSE}

bank_train$agebin <- cut(bank_train$age, c(20,30,35,40,50,60,100))

mytable <- table(bank_train$agebin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("age", "y", "perc")


ba_age_plot <- ggplot(data = tab, aes(x = age, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Age")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_age_plot
grid.text(unit(0.7, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Age",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```

#### Balance

```{r, echo=FALSE, message=FALSE, warning=FALSE}

bank_train$balancebin <- cut(bank_train$balance, c(-10000,0,5000,10000,100000))
mytable <- table(bank_train$balancebin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("balance", "y", "perc")


ba_balance_plot <- ggplot(data = tab, aes(x = balance, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Balance")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_balance_plot

grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Balance",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```

#### Day

```{r, echo=FALSE, message=FALSE, warning=FALSE}

bank_train$daybin <- cut(bank_train$day, c(1,7,14,21,31))

mytable <- table(bank_train$daybin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("day", "y", "perc")


ba_day_plot <- ggplot(data = tab, aes(x = day, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Day")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_day_plot
grid.text(unit(0.7, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Day",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```

#### Duration

```{r, echo=FALSE, message=FALSE, warning=FALSE}

bank_train$durationbin <- cut(bank_train$duration, c(0,100,300,500,1000,5000))

mytable <- table(bank_train$durationbin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("duration", "y", "perc")


ba_duration_plot <- ggplot(data = tab, aes(x = duration, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Duration")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_duration_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Duration",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```


#### Campaign

```{r, echo=FALSE, message=FALSE, warning=FALSE}

bank_train$campaignbin <- cut(bank_train$campaign, c(0,2,3,5,100))


mytable <- table(bank_train$campaignbin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("campaign", "y", "perc")


ba_campaign_plot <- ggplot(data = tab, aes(x = campaign, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Campaign")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_campaign_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Campaign",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```


#### Pdays

```{r,echo=FALSE, warning=FALSE, message=FALSE}

bank_train$pdaysbin <- cut(bank_train$pdays, c(-2,0,200,400,900))

mytable <- table(bank_train$pdaysbin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("pdays", "y", "perc")

ba_pdays_plot <- ggplot(data = tab, aes(x = pdays, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Pdays")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_pdays_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Pdays",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```


#### Previous

```{r, echo=FALSE, message=FALSE, warning=FALSE}

bank_train$prev_bin <- cut(bank_train$previous, c(0,3,5,60))

mytable <- table(bank_train$prev_bin, bank_train$y)
tab <- as.data.frame(prop.table(mytable, 2))
colnames(tab) <-  c("previous", "y", "perc")

ba_previous_plot <- ggplot(data = tab, aes(x = previous, y = perc, fill = y)) + 
  geom_bar(stat = 'identity', position = 'dodge', alpha = 2/3) + 
  theme(axis.text.x=element_text(size=10, angle=90,hjust=0.95,vjust=0.2))+
  xlab("Previous")+
  ylab("Percent")+
  theme_tufte(base_size = 5, ticks=F)+
  theme(plot.margin = unit(c(10,10,10,10),'pt'),
        axis.title=element_blank(),
        axis.text = element_text(colour = color3, size = 10, family = font2),
        axis.text.x = element_text(hjust = 1, size = 10, family = font2, angle = 45),
        legend.position = 'None',
        plot.background = element_rect(fill = color1))

ba_previous_plot
grid.text(unit(0.6, 'npc'), unit(0.9,"npc"), check.overlap = T,just = "left",
          label="Bivariate Analysis - Previous",
          gp=gpar(col=color3, fontsize=13, fontfamily = font2))

```


</br>

***

## Data Preparation  


</br>

***

## Cross-Validation Strategy  

To validate the stability of our models, we will apply a 10-fold cross-validation, repeated 3 times.  

</br>

***

## Baseline  

``` {r Baseline Results, echo=FALSE, message = FALSE, fig.align = 'center'}
all_real_results[1:3,] %>%
  rownames_to_column('Model') %>%
  mutate(
    Sensitivity = cell_spec(
      format(Sensitivity, nsmall = 7),
      color = ifelse(order(Sensitivity) <= 1, 'white', 'ghostwhite'),
      font_size = ifelse(order(Sensitivity) <= 1, 12, 11),
      background = spec_color(
        order(Sensitivity),
        option = 'D',
        begin = 0.50,
        end = 0.98,
        direction = 1
      ),
      bold = ifelse(order(Sensitivity) <= 1, TRUE, FALSE)
    )
  ) %>%
  kable(escape = FALSE, align = 'r') %>% kable_styling(bootstrap_options = c('hover', 'condensed'))
```

</br>

***

## Feature Engineering  



</br>

***

## Feature Selection with Lasso and RFE  



</br>

***

## Tuning  


</br>

***

## Final Model  

The best model for...  

<br><br>

***

###### *Nayla Fakhoury | Martin Hofbauer | Andres Llerena | Francesca Manoni | Paul Jacques-Mignault | Ashley O'Mahony | Stavros Tsentemeidis*
###### *O17 (Group G) | Master in Big Data and Business Analytics | Oct 2018 Intake | IE School of Human Sciences and Technology*

***















